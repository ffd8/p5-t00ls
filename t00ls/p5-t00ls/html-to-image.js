!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).htmlToImage={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function e(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((r=r.apply(t,e||[])).next())}))}function n(t,e){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}var r,o="application/font-woff",i="image/jpeg",u={woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i,jpeg:i,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"},c=(r=0,function(){return r+=1,"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+r});function s(t){var e=function(t){var e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}(t).toLowerCase();return u[e]||""}function f(t){return-1!==t.search(/^(data:)/)}function a(t,e){return"data:"+e+";base64,"+t}function l(t){return t.split(/,/)[1]}function h(t){return t.toBlob?new Promise((function(e){return t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i+=1)o[i]=n.charCodeAt(i);e(new Blob([o],{type:"image/png"}))}))}(t)}function d(t){for(var e=[],n=0,r=t.length;n<r;n+=1)e.push(t[n]);return e}function v(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}function p(t){return new Promise((function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=n,r.crossOrigin="anonymous",r.src=t}))}var g,m={};function w(t,e){var n=t.replace(/\?.*/,"");if(/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),m[n])return m[n];e.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());var r=(window.fetch?window.fetch(t).then((function(t){return t.blob().then((function(e){return{blob:e,contentType:t.headers.get("Content-Type")||""}}))})).then((function(t){var e=t.blob,n=t.contentType;return new Promise((function(t,r){var o=new FileReader;o.onloadend=function(){return t({contentType:n,blob:o.result})},o.onerror=r,o.readAsDataURL(e)}))})).then((function(t){var e=t.blob;return{contentType:t.contentType,blob:l(e)}})):new Promise((function(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var o=new FileReader;o.onloadend=function(){e({blob:l(o.result),contentType:r.getResponseHeader("Content-Type")||""})},o.readAsDataURL(r.response)}else n(new Error("Failed to fetch resource: "+t+", status: "+r.status))},r.ontimeout=function(){n(new Error("Timeout of 30000ms occured while fetching resource: "+t))},r.responseType="blob",r.timeout=3e4,r.open("GET",t,!0),r.send()}))).catch((function(n){var r="";if(e.imagePlaceholder){var o=e.imagePlaceholder.split(/,/);o&&o[1]&&(r=o[1])}var i="Failed to fetch resource: "+t;return n&&(i="string"==typeof n?n:n.message),i&&console.error(i),r}));return m[n]=r,r}function y(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){return r instanceof Element?[2,Promise.resolve().then((function(){return function(t,e){var n=window.getComputedStyle(t),r=e.style;if(!r)return;n.cssText?r.cssText=n.cssText:d(n).forEach((function(t){r.setProperty(t,n.getPropertyValue(t),n.getPropertyPriority(t))}))}(t,r)})).then((function(){return function(t,e){[":before",":after"].forEach((function(n){return g.clonePseudoElement(t,e,n)}))}(t,r)})).then((function(){return function(t,e){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value);t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}(t,r)})).then((function(){return r}))]:[2,r]}))}))}function b(t,r,o){return e(this,void 0,void 0,(function(){return n(this,(function(i){return o||!r.filter||r.filter(t)?[2,Promise.resolve(t).then((function(t){return function(t,r){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return t instanceof HTMLCanvasElement?"data:,"===(e=t.toDataURL())?[2,Promise.resolve(t.cloneNode(!1))]:[2,p(e)]:t instanceof HTMLVideoElement&&t.poster?[2,Promise.resolve(t.poster).then((function(t){return w(t,r)})).then((function(e){return a(e.blob,s(t.poster)||e.contentType)})).then((function(t){return p(t)}))]:[2,Promise.resolve(t.cloneNode(!1))]}))}))}(t,r)})).then((function(o){return function(t,r,o){var i;return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return 0===(e=d((null!==(i=t.shadowRoot)&&void 0!==i?i:t).childNodes)).length?[2,Promise.resolve(r)]:[2,e.reduce((function(t,e){return t.then((function(){return b(e,o)})).then((function(t){t&&r.appendChild(t)}))}),Promise.resolve()).then((function(){return r}))]}))}))}(t,o,r)})).then((function(e){return y(t,e)}))]:[2,Promise.resolve(null)]}))}))}!function(t){t.clonePseudoElement=function(t,e,n){var r=window.getComputedStyle(t,n),o=r.getPropertyValue("content");if(""!==o&&"none"!==o){var i=c();try{e.className=e.className+" "+i}catch(t){return}var u=document.createElement("style");u.appendChild(function(t,e,n){var r="."+t+":"+e,o=n.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: '"+e.replace(/'|"/g,"")+"';"}(n):function(t){return d(t).map((function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")+";"})).join(" ")}(n);return document.createTextNode(r+"{"+o+"}")}(i,n,r)),e.appendChild(u)}}}(g||(g={}));var P=/url\((['"]?)([^'"]+?)\1\)/g,S=/url\([^)]+\)\s*format\((["'])([^"']+)\1\)/g,E=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function x(t){return-1!==t.search(P)}function T(t,e,n){if(!x(t))return Promise.resolve(t);var r,o,i=(r=t,(o=n.preferredFontFormat)?r.replace(E,(function(t){for(;;){var e=S.exec(t)||[],n=e[0],r=e[2];if(!r)return"";if(r===o)return"src: "+n+";"}})):r);return Promise.resolve(i).then(R).then((function(t){return t.reduce((function(t,r){return t.then((function(t){return function(t,e,n,r,o){var i=n?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;var n=document.implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");n.head.appendChild(r),n.body.appendChild(o),e&&(r.href=e);return o.href=t,o.href}(e,n):e;return Promise.resolve(i).then((function(t){return o?o(t):w(t,r)})).then((function(t){return"string"==typeof t?a(t,s(e)):a(t.blob,s(e)||t.contentType)})).then((function(n){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}(t)+")(['\"]?\\))","g")}(e),"$1"+n+"$3")})).then((function(t){return t}),(function(){return i}))}(t,r,e,n)}))}),Promise.resolve(i))}))}function R(t){var e=[];return t.replace(P,(function(t,n,r){return e.push(r),t})),e.filter((function(t){return!f(t)}))}function C(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(o){return t instanceof Element?[2,Promise.resolve(t).then((function(t){return function(t,r){var o;return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return(e=null===(o=t.style)||void 0===o?void 0:o.getPropertyValue("background"))?[2,Promise.resolve(e).then((function(t){return T(t,null,r)})).then((function(e){return t.style.setProperty("background",e,t.style.getPropertyPriority("background")),t}))]:[2,Promise.resolve(t)]}))}))}(t,r)})).then((function(t){return function(t,e){if(!(t instanceof HTMLImageElement)||f(t.src))return Promise.resolve(t);var n=t.src;return Promise.resolve(n).then((function(t){return w(t,e)})).then((function(t){return a(t.blob,s(n)||t.contentType)})).then((function(e){return new Promise((function(n,r){t.onload=n,t.onerror=r,t.srcset="",t.src=e}))})).then((function(){return t}),(function(){return t}))}(t,r)})).then((function(t){return function(t,r){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(n){return e=d(t.childNodes),o=e.map((function(t){return C(t,r)})),[2,Promise.all(o).then((function(){return t}))]}))}))}(t,r)}))]:[2,Promise.resolve(t)]}))}))}var L={};function N(t){return e(this,void 0,void 0,(function(){return n(this,(function(r){return[2,new Promise((function(e,n){t.ownerDocument||n(new Error("Provided element is not within a Document")),e(d(t.ownerDocument.styleSheets))})).then((function(t){return function(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){return e=[],r=[],t.forEach((function(e){if("cssRules"in e)try{d(e.cssRules).forEach((function(t,n){if(t.type===CSSRule.IMPORT_RULE){var o=n+1;r.push(I(t.href,e).then(M).then((function(t){D(t).forEach((function(t){try{e.insertRule(t,t.startsWith("@import")?o+=1:e.cssRules.length)}catch(e){console.log("Error inserting rule from remote css",{rule:t,error:e})}}))})).catch((function(t){console.log("Error loading remote css",t.toString())})))}}))}catch(o){var n=t.find((function(t){return null===t.href}))||document.styleSheets[0];null!=e.href&&r.push(I(e.href).then(M).then((function(t){D(t).forEach((function(t){n.insertRule(t,e.cssRules.length)}))})).catch((function(t){console.log("Error loading remote stylesheet",t.toString())}))),console.log("Error inlining remote css file",o.toString())}})),[2,Promise.all(r).then((function(){return t.forEach((function(t){if("cssRules"in t)try{d(t.cssRules).forEach((function(t){e.push(t)}))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e}))]}))}))}(t)})).then(k)]}))}))}function A(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,N(t).then((function(t){return Promise.all(t.map((function(t){var e=t.parentStyleSheet?t.parentStyleSheet.href:null;return T(t.cssText,e,r)})))})).then((function(t){return t.join("\n")}))]}))}))}function k(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return x(t.style.getPropertyValue("src"))}))}function D(t){if(void 0===t)return[];var e=t,n=[],r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;e=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var o,i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(o=i.exec(e));)n.push(o[0]);e=e.replace(i,"");for(var u=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){if(null===(o=r.exec(e))){if(null===(o=u.exec(e)))break;r.lastIndex=u.lastIndex}else u.lastIndex=r.lastIndex;n.push(o[0])}return n}function I(t,e){if(L[t])return L[t];var n=fetch(t).then((function(e){return{url:t,cssText:e.text()}}),(function(t){console.log("ERROR FETCHING CSS: ",t.toString())}));return L[t]=n,n}function M(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,t.cssText.then((function(e){var n=e,r=/url\(["']?([^"')]+)["']?\)/g,o=(n.match(/url\([^)]+\)/g)||[]).map((function(e){var o=e.replace(r,"$1");if(!o.startsWith("https://")){var i=t.url;o=new URL(o,i).href}return new Promise((function(t,r){fetch(o).then((function(t){return t.blob()})).then((function(r){var o=new FileReader;o.addEventListener("load",(function(r){n=n.replace(e,"url("+o.result+")"),t([e,o.result])})),o.readAsDataURL(r)})).catch(r)}))}));return Promise.all(o).then((function(){return n}))}))]}))}))}function U(t,r,o){var i="http://www.w3.org/2000/svg",u=document.createElementNS(i,"svg"),c=document.createElementNS(i,"foreignObject");return u.setAttributeNS("","width",""+r),u.setAttributeNS("","height",""+o),u.setAttributeNS("","viewBox","0 0 "+r+" "+o),c.setAttributeNS("","width","100%"),c.setAttributeNS("","height","100%"),c.setAttributeNS("","x","0"),c.setAttributeNS("","y","0"),c.setAttributeNS("","externalResourcesRequired","true"),u.appendChild(c),c.appendChild(t),function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,Promise.resolve().then((function(){return(new XMLSerializer).serializeToString(t)})).then(encodeURIComponent).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))]}))}))}(u)}function F(t,e){var n,r,o;return void 0===e&&(e={}),{width:e.width||(r=v(n=t,"border-left-width"),o=v(n,"border-right-width"),n.clientWidth+r+o),height:e.height||function(t){var e=v(t,"border-top-width"),n=v(t,"border-bottom-width");return t.clientHeight+e+n}(t)}}function H(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){var o,i,u;return n(this,(function(c){return o=F(t,r),i=o.width,u=o.height,[2,b(t,r,!0).then((function(t){return function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,(null!=r.fontEmbedCss?Promise.resolve(r.fontEmbedCss):A(t,r)).then((function(e){var n=document.createElement("style"),r=document.createTextNode(e);return n.appendChild(r),t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),t}))]}))}))}(t,r)})).then((function(t){return C(t,r)})).then((function(t){return function(t,e){var n=t.style;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=e.width+"px"),e.height&&(n.height=e.height+"px");var r=e.style;return null!=r&&Object.keys(r).forEach((function(t){n[t]=r[t]})),t}(t,r)})).then((function(t){return U(t,i,u)}))]}))}))}var j=H;function V(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,H(t,r).then(p).then((n=100,function(t){return new Promise((function(e){setTimeout((function(){e(t)}),n)}))})).then((function(e){var n=document.createElement("canvas"),o=n.getContext("2d"),i=r.pixelRatio||function(){var t,e;try{e=process}catch(t){}var n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}(),u=F(t,r),c=u.width,s=u.height,f=r.canvasWidth||c,a=r.canvasHeight||s;return n.width=f*i,n.height=a*i,n.style.width=""+f,n.style.height=""+a,r.backgroundColor&&(o.fillStyle=r.backgroundColor,o.fillRect(0,0,n.width,n.height)),o.drawImage(e,0,0,n.width,n.height),n}))];var n}))}))}t.getWebFontEmbedCss=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,A(t,r)]}))}))},t.toBlob=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,V(t,r).then(h)]}))}))},t.toCanvas=V,t.toJpeg=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,V(t,r).then((function(t){return t.toDataURL("image/jpeg",r.quality||1)}))]}))}))},t.toPixelData=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){var e,o,i;return n(this,(function(n){return e=F(t,r),o=e.width,i=e.height,[2,V(t,r).then((function(t){return t.getContext("2d").getImageData(0,0,o,i).data}))]}))}))},t.toPng=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,(function(){return n(this,(function(e){return[2,V(t,r).then((function(t){return t.toDataURL()}))]}))}))},t.toSvg=H,t.toSvgDataURL=j,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=html-to-image.js.map
